<!-- 
  Mental Approach Quiz App (quadrilingual)
  Source document (local path): /mnt/data/A_2D_digital_screenshot_of_a_tennis_IQ_test_titled.png
  Paste this file as mental_quiz.html and host it on any static host.
-->
<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Test Mental Tennis ‚Äî Quadrilingue</title>
<style>

.home-btn{
  margin-left:auto;
  margin-right:8px;
  text-decoration:none;
  font-size:18px;
  background:#fff;
  border:1px solid rgba(122,79,255,.2);
  color:var(--accent);
  padding:8px 10px;
  border-radius:10px;
  font-weight:700;
  transition:.15s ease;
}
.home-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 18px rgba(122,79,255,.25);
}








  :root{
    --bg:#f3f6fb; --card:#ffffff; --muted:#6b7280; --accent:#7a4fff;
    --green:#16a34a; --red:#ef4444; --purple:#6a37d8;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;}
  body{
    margin:0; background:linear-gradient(180deg,#eaf4ff,#f3f6fb);
    color:#0b1224; display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .container{width:100%;max-width:980px;background:var(--card);border-radius:14px;box-shadow:0 10px 40px rgba(2,6,23,0.08);overflow:hidden;}
  header{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(11,17,36,0.04)}
  .logo{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,#fff,#f3f6fb);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);font-size:20px}
  h1{margin:0;font-size:18px}
  .lang{margin-left:auto;display:flex;gap:8px}
  .flag-btn{background:none;border:0;cursor:pointer;font-size:20px;padding:6px;border-radius:8px}
  main{display:flex;gap:16px;padding:18px}
  .left{flex:1;min-width:320px}
  .card{background:#fff;border-radius:12px;padding:14px;border:1px solid rgba(11,17,36,0.04)}
  .intro p{color:var(--muted);margin:8px 0 0}
  .question-number{font-size:13px;color:var(--muted);margin-bottom:6px}
  .question-text{font-size:18px;margin:6px 0 14px}
  .choices{display:flex;flex-direction:column;gap:10px}
  .choice{border:1px solid rgba(11,17,36,0.06);padding:12px;border-radius:10px;cursor:pointer;background:#fbfdff;transition:all .12s;display:flex;align-items:center;justify-content:space-between}
  .choice:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(2,6,23,0.06)}
  .choice.selected{background:linear-gradient(180deg,#f1e9ff,#efe6ff);border-color:rgba(106,55,216,0.18)}
  .choice.correct{background:linear-gradient(180deg,#e9f8ec,#d6f1d9);border-color:rgba(22,163,74,0.14)}
  .choice.wrong{background:linear-gradient(180deg,#ffecec,#ffd6d6);border-color:rgba(239,68,68,0.12)}
  .choice .label{font-weight:600}
  .choice .meta{font-size:14px;color:var(--muted)}
  .footer{display:flex;align-items:center;justify-content:space-between;margin-top:14px;gap:12px}
  .btn{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .btn.secondary{background:#fff;color:var(--accent);border:1px solid rgba(122,79,255,0.12)}
  .progress{height:10px;background:#f0f4fb;border-radius:999px;overflow:hidden;margin-top:10px}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#5e32c8);width:0%}
  .results .score{font-size:28px;font-weight:800;color:var(--accent)}
  .small{font-size:13px;color:var(--muted)}
  footer{padding:10px 18px;color:var(--muted);font-size:13px;text-align:center}
  .review-q{background:#fff;padding:14px;border-radius:10px;margin-bottom:12px;border:1px solid #eef2f7}
  .review-opt{padding:10px;border-radius:8px;margin:8px 0;display:flex;justify-content:space-between;align-items:center}
  .sel{background:linear-gradient(180deg,#efe0ff,#efe6ff);border:1px solid #b08cff}
  .corr{background:linear-gradient(180deg,#e8f8ec,#dff5e6);border:1px solid #8dd39a}
  .wr{background:linear-gradient(180deg,#ffecec,#ffd6d6);border:1px solid #f19b9b}
  .explain{font-size:14px;color:#0b1224;margin-top:8px;padding-left:6px}
  .source{font-size:12px;color:var(--muted);margin-top:8px}
  @media (max-width:900px){ main{flex-direction:column} .lang{margin-left:0} }
</style>
</head>
<body>
<div class="container" role="application" aria-label="Mental Tennis Quiz">
  <header><a id="homeBtn" href="../index.html" class="home-btn" title="Home">üè†</a>
    <div style="display:flex;align-items:center;gap:12px">
      <div class="logo">EG</div>
      <div>
        <h1 id="mainTitle">Technical - Strategy ‚Äî Tennis</h1>
        <div id="subtitle" class="small">Technical - Elevate your Game</div>
      </div>
    </div>

    <div class="lang" aria-label="language selector">
      <button class="flag-btn" data-lang="en">üá¨üáß</button>
      <button class="flag-btn" data-lang="fr">üá´üá∑</button>
      
      <button class="flag-btn" data-lang="de">üá©üá™</button>
      <button class="flag-btn" data-lang="nl">üá≥üá±</button>
    </div>
  </header>

  <main>
    <div class="left">
      <div id="introCard" class="card intro">
        <div id="titleLine"><strong id="titlePart">L‚ÄôArt de la Concentration ‚Äî </strong><span id="titleSub">Technical - Strategy- Tennis</span></div>
        <p id="lead" class="small">Questions bas√©es sur le document "L'Art de la Concentration dans le Tennis" (Inner Game)</p>
        <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
          <button id="startBtn" class="btn">Commencer</button>
          <button id="guideBtn" class="btn secondary">Guide</button>
        </div>
        <div class="source">Source (local file) : <a href="/mnt/data/A_2D_digital_screenshot_of_a_tennis_IQ_test_titled.png" target="_blank">/mnt/data/A_2D_digital_screenshot_of_a_tennis_IQ_test_titled.png</a></div>
      </div>

      <div id="quizCard" class="card" style="display:none;margin-top:12px">
        <div class="question-number" id="qNum">Question 1 / 20</div>
        <div class="question-text" id="qText">...</div>
        <div class="choices" id="choices"></div>

        <div class="footer">
          <div style="flex:1">
            <div class="progress" aria-hidden="true"><i id="progBar"></i></div>
          </div>
          <div style="display:flex;gap:8px">
            <button id="prevBtn" class="btn secondary" disabled>Pr√©c√©dent</button>
            <button id="nextBtn" class="btn">Suivant</button>
          </div>
        </div>
      </div>

      <div id="resultCard" class="card" style="display:none;margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small" id="resLabel">Ton score</div>
            <div class="score" id="scoreText">0 / 20</div>
          </div>
          <div id="levelInfo" style="text-align:right"></div>
        </div>
        <div id="feedback" style="margin-top:12px;color:#0b1224"></div>

        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="retakeBtn" class="btn">Recommencer (nouveau 20)</button>
          <button id="reviewBtn" class="btn secondary">Voir r√©ponses corrig√©es</button>
          <button id="exportBtn" class="btn secondary">Exporter CSV</button>
        </div>
      </div>
    </div>

    <div class="right" style="width:320px;min-width:220px">
      <div class="card">
        <h3 id="panelTitle">Comment √ßa marche</h3>
        <p id="panelText" class="small">20 questions al√©atoires issues d'un pool de 100, g√©n√©r√©es depuis le document re√ßu.</p>
        <hr />
        <div style="margin-top:8px">
          <div class="small"><strong>L√©gende</strong></div>
          <div style="display:flex;gap:6px;align-items:center;margin-top:8px">
            <div style="width:14px;height:14px;border-radius:3px;background:var(--purple)"></div><div class="small">Ta r√©ponse s√©lectionn√©e</div>
          </div>
          <div style="display:flex;gap:6px;align-items:center;margin-top:6px">
            <div style="width:14px;height:14px;border-radius:3px;background:var(--green)"></div><div class="small">R√©ponse correcte</div>
          </div>
          <div style="display:flex;gap:6px;align-items:center;margin-top:6px">
            <div style="width:14px;height:14px;border-radius:3px;background:var(--red)"></div><div class="small">Mauvaise r√©ponse</div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="small"><strong>Langue</strong></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="flag-btn" data-lang="en">üá¨üáß English</button>
          <button class="flag-btn" data-lang="fr">üá´üá∑ Fran√ßais</button>
          
          <button class="flag-btn" data-lang="de">üá©üá™ Deutsch</button>
          <button class="flag-btn" data-lang="nl">üá≥üá± Nederlands</button>
        </div>
      </div>
    </div>
  </main>

  <footer>¬© Coach Panos Lev ‚Äî Mental Tennis Quiz</footer>
</div>

<script>
/* -------------------------------------------------------
   Mental Quiz app
   - Pools generated (100 questions per language) from document
   - Each item: {q, options:[...], answer:index, explain:"..."}
   - 20 random unique questions per run
   - Quadrilingual UI texts
--------------------------------------------------------*/

/* UI translations */
const UI = {
 en: {
    mainTitle: "Technical - Strategy ‚Äî Champion mindset",
    subtitle: "Concentration & Mindset",
    start: "Start", guide: "Guide", next: "Next", prev: "Prev",
    retake: "Retake (new 20)", review: "See corrected answers",
    lead: "20 questions based on the provided document: 'Champion mindset'.",
    how: "20 randomized questions from a 100-question pool. Review explanations after the test.",
    resYourScore: "Your score", selectPrompt: "Choose an answer", exportCsv: "Export CSV"
  },

  fr: {
    mainTitle: "Technique & Strat√©gie ‚Äî Mental de Champion",
    subtitle: "Concentration & √©tat d'esprit",
    start: "Commencer", guide: "Guide", next: "Suivant", prev: "Pr√©c√©dent",
    retake: "Recommencer (nouveau 20)", review: "Voir r√©ponses corrig√©es",
    lead: "20 questions bas√©es sur le document fourni : 'Champion mindset'.",
    how: "20 questions al√©atoires tir√©es d'un pool de 100. Apr√®s le test, consulte les explications.",
    resYourScore: "Ton score", selectPrompt: "Choisis une r√©ponse", exportCsv: "Exporter CSV"
  },
  
  de: {
    mainTitle: "Technik & Strategie ‚Äî Siegermentalit√§t",
    subtitle: "Konzentration & Geisteshaltung",
    start: "Start", guide: "Anleitung", next: "Weiter", prev: "Zur√ºck",
    retake: "Erneut (neu 20)", review: "Korrigierte Antworten ansehen",
    lead: "20 Fragen basierend auf dem Dokument: 'Champion mindset'.",
    how: "20 zuf√§llige Fragen aus einem Pool von 100. Erkl√§rungen nach dem Test anzeigen.",
    resYourScore: "Dein Ergebnis", selectPrompt: "W√§hle eine Antwort", exportCsv: "CSV exportieren"
  },
  nl: {
    mainTitle: "Techniek & Strategie ‚Äî Kampioensmentaliteit",
    subtitle: "Concentratie & Mindset",
    start: "Start", guide: "Gids", next: "Volgende", prev: "Vorige",
    retake: "Opnieuw (nieuwe 20)", review: "Bekijk gecorrigeerde antwoorden",
    lead: "20 vragen gebaseerd op het document: 'Champion mindset'.",
    how: "20 willekeurige vragen uit een pool van 100. Bekijk uitleg na de test.",
    resYourScore: "Jouw score", selectPrompt: "Kies een antwoord", exportCsv: "Exporteer CSV"
  }
};

/* simple shuffle */
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; }

/* --- Templates derived from the provided mental document
   Themes: Inner Game (Self1/Self2), concentration, letting go, observation, practice, ego, competition vs collaboration, learning, stress, calm focus.
   We generate many variations to reach 100 items per language.
*/
const TEMPLATES = {

  /* =========================
     üá¨üáß ENGLISH ‚Äî 20 QUESTIONS
     ========================= */
  en: {
    templates: [
      ()=>({q:"Why is advanced tennis about more than technique alone?",options:["Technique wins every match","Mental and physical conditioning are equally critical","Only fitness matters","Equipment decides outcomes"],answer:1,level:"easy",explain:"At advanced levels, performance depends on mental resilience and physical preparation, not just technique."}),
      ()=>({q:"What is the primary role of footwork in advanced tennis?",options:["Running faster","Reaching the ball early and staying balanced","Looking athletic","Saving energy"],answer:1,level:"easy",explain:"Efficient footwork ensures balance, early positioning, and shot control."}),
      ()=>({q:"Why should advanced players vary their serve?",options:["To reduce fatigue","To confuse the opponent","To shorten matches","To avoid training"],answer:1,level:"easy",explain:"Serve variation prevents opponents from anticipating placement, speed, and spin."}),
      ()=>({q:"Which serve produces a high bounce and added safety?",options:["Flat serve","Kick serve","Slice serve","Body serve"],answer:1,level:"easy",explain:"The kick serve uses topspin to create a higher bounce and more margin."}),
      ()=>({q:"When is a flat serve most effective?",options:["On second serves","When dominating with speed","When tired","When defending"],answer:1,level:"easy",explain:"Flat serves are aggressive weapons used to apply maximum pressure."}),

      // 6‚Äì20 (medium)
      ()=>({q:"What is the main goal of tactical game planning?",options:["Winning quickly","Playing randomly","Exploiting opponent weaknesses","Avoiding rallies"],answer:2,level:"medium",explain:"A game plan targets weaknesses and maximizes strengths."}),
      ()=>({q:"Why is anticipation important in advanced tennis?",options:["It improves fitness","It reduces reaction time","It slows the match","It replaces technique"],answer:1,level:"medium",explain:"Anticipation allows earlier movement and better positioning."}),
      ()=>({q:"What does controlling match tempo help achieve?",options:["More winners","Mental dominance","Less movement","More rest"],answer:1,level:"medium",explain:"Changing pace disrupts opponent rhythm and momentum."}),
      ()=>({q:"Why is recovery positioning critical after each shot?",options:["Looks professional","Covers more court","Reduces fatigue","Prevents faults"],answer:1,level:"medium",explain:"Returning to center maximizes court coverage."}),
      ()=>({q:"What is the main purpose of cross-court shots?",options:["Speed","Margin and angles","Defense only","Ending rallies"],answer:1,level:"medium",explain:"Cross-court shots create safer angles and stretch opponents."}),

      // 21‚Äì35 (advanced)
      ()=>({q:"Why is momentum management crucial in matches?",options:["Momentum is random","It determines psychological control","It affects only beginners","It replaces tactics"],answer:1,level:"advanced",explain:"Momentum impacts confidence, decision-making, and pressure handling."}),
      ()=>({q:"How should players respond to negative momentum?",options:["Play faster","Change pace and reset mentally","Hit harder","Ignore it"],answer:1,level:"advanced",explain:"Resetting tempo and focus helps regain control."}),
      ()=>({q:"Why is serving under pressure different?",options:["More power needed","Mental execution matters most","Technique changes","Rules change"],answer:1,level:"advanced",explain:"Pressure tests trust in routine and technique."}),
      ()=>({q:"What is the value of pre-point routines?",options:["Time wasting","Mental reset","Intimidation","Physical recovery"],answer:1,level:"advanced",explain:"Routines stabilize focus under stress."}),
      ()=>({q:"Why must advanced players adapt tactics mid-match?",options:["To surprise spectators","Because opponents adjust","To finish faster","To conserve energy"],answer:1,level:"advanced",explain:"Adaptability prevents predictability."}),

      // 36‚Äì50 (advanced)
      ()=>({q:"Why are angles essential in advanced play?",options:["They look impressive","They stretch opponents efficiently","They reduce errors","They slow rallies"],answer:1,level:"advanced",explain:"Angles force movement and open the court."}),
      ()=>({q:"What does effective net transition require?",options:["Speed only","Timing and positioning","Luck","Power"],answer:1,level:"advanced",explain:"Transitioning forward requires recognizing opportunity."}),
      ()=>({q:"Why are deceptive shots valuable?",options:["They waste energy","They disrupt rhythm","They slow play","They avoid rallies"],answer:1,level:"advanced",explain:"Deception forces hesitation and positioning errors."}),
      ()=>({q:"Why is long-term planning important?",options:["Avoid injuries","Sustain progress","Win immediately","Reduce training"],answer:1,level:"advanced",explain:"Clear goals guide development."}),
      ()=>({q:"What mindset defines elite players?",options:["Fearless","Growth-oriented","Aggressive only","Results-focused"],answer:1,level:"advanced",explain:"Elite players focus on continuous improvement."})
    ]
  },

  /* =========================
     üá´üá∑ FRAN√áAIS ‚Äî 20 QUESTIONS
     ========================= */
  fr:{
    templates:[
      ()=>({q:"Quel est l‚Äôobjectif principal de la tactique avanc√©e ?",options:["Puissance","Contr√¥le","Chance","Vitesse"],answer:1,explain:"La tactique avanc√©e vise √† contr√¥ler le jeu et l‚Äôadversaire."}),
      ()=>({q:"Pourquoi le jeu de jambes est-il essentiel ?",options:["Style","√âquilibre et placement","Force","Vitesse pure"],answer:1,explain:"Un bon jeu de jambes garantit √©quilibre et pr√©cision."}),
      ()=>({q:"√Ä quoi sert l‚Äôadaptation tactique ?",options:["Improviser","R√©agir √† l‚Äôadversaire","Jouer plus vite","R√©duire l‚Äôeffort"],answer:1,explain:"L‚Äôadaptation permet de r√©pondre aux changements du match."}),
      ()=>({q:"Pourquoi varier le service ?",options:["Impressionner","Casser le rythme","√âconomiser l‚Äô√©nergie","Limiter les fautes"],answer:1,explain:"La variation emp√™che l‚Äôanticipation."}),
      ()=>({q:"Qu‚Äôest-ce que le momentum ?",options:["Vitesse","Flux psychologique","Endurance","Timing"],answer:1,explain:"Le momentum influence la dynamique mentale du match."}),
      ()=>({q:"Pourquoi jouer crois√© ?",options:["Puissance","Marge de s√©curit√©","Effet","Esth√©tique"],answer:1,explain:"Le crois√© offre plus de marge au-dessus du filet."}),
      ()=>({q:"Pourquoi revenir au centre ?",options:["Habitude","Couverture maximale","√âconomie","Style"],answer:1,explain:"Le centre permet de couvrir tout le court."}),
      ()=>({q:"Pourquoi utiliser le slice en d√©fense ?",options:["Vitesse","Balle basse","Puissance","Pr√©cision"],answer:1,explain:"Le slice ralentit le jeu et g√™ne l‚Äôadversaire."}),
      ()=>({q:"Pourquoi anticiper ?",options:["Chance","R√©flexes","Gain de temps","Force"],answer:2,explain:"Anticiper r√©duit le temps de r√©action."}),
      ()=>({q:"Pourquoi construire l‚Äô√©change ?",options:["Fatiguer","Provoquer l‚Äôerreur","√âconomiser","Ralentir"],answer:1,explain:"La r√©gularit√© force l‚Äôerreur adverse."}),
      ()=>({q:"Pourquoi monter au filet ?",options:["Finir vite","Varier le rythme","Dominer","√âconomiser"],answer:1,explain:"Le filet casse le rythme du fond de court."}),
      ()=>({q:"Pourquoi masquer ses coups ?",options:["Style","Surprendre","Puissance","Effet"],answer:1,explain:"La dissimulation r√©duit l‚Äôanticipation adverse."}),
      ()=>({q:"Pourquoi g√©rer ses √©motions ?",options:["P√©nalit√©s","Clart√© mentale","Image","Public"],answer:1,explain:"La stabilit√© √©motionnelle am√©liore les d√©cisions."}),
      ()=>({q:"Pourquoi planifier les points ?",options:["Routine","Efficacit√©","Hasard","M√©moire"],answer:1,explain:"La planification am√©liore l‚Äôex√©cution."}),
      ()=>({q:"Pourquoi changer le tempo ?",options:["Acc√©l√©rer","D√©stabiliser","Finir","Se reposer"],answer:1,explain:"Le changement de rythme perturbe l‚Äôadversaire."}),
      ()=>({q:"Pourquoi s‚Äôentra√Æner sous pression ?",options:["Stress","Confiance","Fatigue","Inconfort"],answer:1,explain:"Cela pr√©pare aux situations r√©elles."}),
      ()=>({q:"Pourquoi visualiser ?",options:["D√©tente","Confiance","M√©moire","Concentration"],answer:1,explain:"La visualisation renforce la pr√©paration mentale."}),
      ()=>({q:"Pourquoi servir au corps ?",options:["S√©curit√©","Bloquer le geste","Moins de risque","Angle"],answer:1,explain:"Le service au corps g√™ne la frappe."}),
      ()=>({q:"Pourquoi jouer les angles ?",options:["Esth√©tique","Ouvrir le court","Puissance","Effet"],answer:1,explain:"Les angles d√©placent l‚Äôadversaire."}),
      ()=>({q:"Pourquoi privil√©gier la r√©gularit√© ?",options:["Vitesse","Forcer l‚Äôerreur","√âviter l‚Äô√©change","Finir vite"],answer:1,explain:"La r√©gularit√© gagne √† haut niveau."}),
      ()=>({q:"Pourquoi travailler l‚Äô√©quilibre ?",options:["Style","Contr√¥le","Force","Vitesse"],answer:1,explain:"L‚Äô√©quilibre assure la ma√Ætrise du geste."}),
      ()=>({q:"Pourquoi ajuster en match ?",options:["Habitude","√âvolution adverse","Coach","Fatigue"],answer:1,explain:"Le match √©volue constamment."}),
      ()=>({q:"Pourquoi analyser l‚Äôadversaire ?",options:["Curiosit√©","Identifier faiblesses","Confiance","Pr√©paration"],answer:1,explain:"L‚Äôanalyse r√©v√®le les points faibles."}),
      ()=>({q:"Pourquoi contr√¥ler le rythme ?",options:["√ânergie","Dominer","Style","Vitesse"],answer:1,explain:"Le rythme dicte le jeu."}),
      ()=>({q:"Pourquoi des routines ?",options:["Temps","Stabilit√©","Confort","D√©tente"],answer:1,explain:"Les routines stabilisent la performance."}),
      ()=>({q:"Pourquoi travailler la r√©cup√©ration ?",options:["Esth√©tique","Position","√ânergie","Vitesse"],answer:1,explain:"La r√©cup√©ration replace efficacement."}),
      ()=>({q:"Pourquoi construire l‚Äôendurance ?",options:["Matchs longs","Puissance","Vitesse","Muscle"],answer:0,explain:"L‚Äôendurance soutient la performance."}),
      ()=>({q:"Pourquoi conditionner le mental ?",options:["Calme","D√©cision","Focus","Tout"],answer:3,explain:"Le mental influence tout le jeu."}),
      ()=>({q:"Pourquoi s‚Äôadapter aux surfaces ?",options:["Habitude","Rebond","Vitesse","Tout"],answer:3,explain:"Chaque surface change le jeu."}),
      ()=>({q:"Pourquoi g√©rer les balles de break ?",options:["Score","Pression","Momentum","Tout"],answer:3,explain:"Elles font basculer le match."}),
      ()=>({q:"Pourquoi simplifier sous pression ?",options:["Peur","Clart√©","Vitesse","√ânergie"],answer:1,explain:"La simplicit√© am√©liore l‚Äôex√©cution."}),
      ()=>({q:"Pourquoi faire confiance √† la pr√©paration ?",options:["Habitude","Confiance","M√©moire","Chance"],answer:1,explain:"La confiance r√©duit le stress."}),
      ()=>({q:"Pourquoi analyser ses matchs ?",options:["Stats","Progression","Critique","Classement"],answer:1,explain:"L‚Äôanalyse permet d‚Äô√©voluer."}),
      ()=>({q:"Pourquoi se discipliner ?",options:["R√®gles","Progression","Peur","Contr√¥le"],answer:1,explain:"La discipline cr√©e la constance."}),
      ()=>({q:"Pourquoi accepter les d√©fis ?",options:["Risque","Croissance","Stress","Douleur"],answer:1,explain:"Les d√©fis font progresser."}),
      ()=>({q:"Pourquoi r√©fl√©chir r√©guli√®rement ?",options:["M√©moire","Conscience","Routine","Habitude"],answer:1,explain:"La r√©flexion affine le jeu."}),
      ()=>({q:"Pourquoi viser la ma√Ætrise ?",options:["Titres","Processus","Ego","Perfection"],answer:1,explain:"La ma√Ætrise est un chemin continu."}),
      ()=>({q:"Pourquoi appr√©cier le parcours ?",options:["Motivation","Long√©vit√©","√âquilibre","Tout"],answer:3,explain:"Le plaisir soutient la performance."})
    ]
  },

  /* =========================
     üá©üá™ DEUTSCH ‚Äî 20 FRAGEN
     ========================= */
  de: {
    templates: [
      ()=>({q:"Was ist das wichtigste Ziel fortgeschrittener Tennistaktik?",options:["Kraft","Kontrolle","Gl√ºck","Tempo"],answer:1,explain:"Fortgeschrittene Taktik zielt darauf ab, Ballwechsel und Gegner zu kontrollieren."}),
      ()=>({q:"Warum ist Beinarbeit auf hohem Niveau entscheidend?",options:["Optik","Balance und Positionierung","Kraft","Reine Geschwindigkeit"],answer:1,explain:"Gute Beinarbeit sorgt f√ºr Gleichgewicht und pr√§zise Schl√§ge."}),
      ()=>({q:"Warum muss sich ein Spieler taktisch anpassen?",options:["Um zu improvisieren","Um auf den Gegner zu reagieren","Um schneller zu spielen","Um Kraft zu sparen"],answer:1,explain:"Anpassung ist notwendig, weil sich Matchdynamik und Gegnerverhalten √§ndern."}),
      ()=>({q:"Warum sollte der Aufschlag variiert werden?",options:["Um zu beeindrucken","Um den Rhythmus zu brechen","Um Energie zu sparen","Um Fehler zu vermeiden"],answer:1,explain:"Variation verhindert, dass der Gegner den Aufschlag antizipiert."}),
      ()=>({q:"Was bedeutet Momentum im Tennis?",options:["Tempo","Psychologischer Spielfluss","Ausdauer","Timing"],answer:1,explain:"Momentum beschreibt die mentale und emotionale Dynamik eines Matches."}),
      ()=>({q:"Warum sind Cross-Schl√§ge effektiv?",options:["Mehr Kraft","Gr√∂√üere Sicherheit","Mehr Spin","Bessere Optik"],answer:1,explain:"Cross-Schl√§ge bieten mehr Platz √ºber dem Netz und mehr Sicherheit."}),
      ()=>({q:"Warum sollte man nach jedem Schlag zur Mitte zur√ºckkehren?",options:["Gewohnheit","Maximale Court-Abdeckung","Energiesparen","Stil"],answer:1,explain:"Die Mittelposition erlaubt schnellere Reaktionen auf den n√§chsten Ball."}),
      ()=>({q:"Warum ist der Slice in der Defensive n√ºtzlich?",options:["Er ist schneller","Er h√§lt den Ball niedrig","Er erzeugt mehr Power","Er ist pr√§ziser"],answer:1,explain:"Ein Slice verlangsamt das Spiel und zwingt den Gegner in tiefe Positionen."}),
      ()=>({q:"Warum ist Antizipation wichtig?",options:["Gl√ºck","Reflexe","Zeitgewinn","Kraft"],answer:2,explain:"Antizipation reduziert Reaktionszeit und verbessert Positionierung."}),
      ()=>({q:"Warum sollte ein Ballwechsel aufgebaut werden?",options:["Um zu erm√ºden","Um Fehler zu erzwingen","Um Zeit zu sparen","Um schneller zu gewinnen"],answer:1,explain:"Konstanz zwingt den Gegner zu Fehlern."}),
      ()=>({q:"Warum ist Netzspiel wichtig?",options:["Schneller Punkt","Rhythmuswechsel","Dominanz","Energiesparen"],answer:1,explain:"Netzangriffe ver√§ndern Tempo und Rhythmus des Spiels."}),
      ()=>({q:"Warum sollte man Schl√§ge verschleiern?",options:["Stil","√úberraschung","Kraft","Spin"],answer:1,explain:"T√§uschung verhindert fr√ºhzeitige Antizipation."}),
      ()=>({q:"Warum ist Emotionskontrolle entscheidend?",options:["Strafen","Klare Entscheidungen","Image","Publikum"],answer:1,explain:"Emotionale Stabilit√§t verbessert taktische Entscheidungen."}),
      ()=>({q:"Warum Punkte planen?",options:["Routine","Effizienz","Zufall","Ged√§chtnis"],answer:1,explain:"Planung erh√∂ht die Erfolgswahrscheinlichkeit."}),
      ()=>({q:"Warum sollte das Tempo variiert werden?",options:["Beschleunigen","Den Gegner destabilisieren","Punkte beenden","Ausruhen"],answer:1,explain:"Tempowechsel bringen den Gegner aus dem Gleichgewicht."}),
      ()=>({q:"Warum unter Druck trainieren?",options:["Stress","Sicherheit","Ersch√∂pfung","Unbehagen"],answer:1,explain:"Drucktraining simuliert reale Spielsituationen."}),
      ()=>({q:"Warum ist Visualisierung wichtig?",options:["Entspannung","Selbstvertrauen","Ged√§chtnis","Fokus"],answer:1,explain:"Visualisierung st√§rkt mentale Vorbereitung."}),
      ()=>({q:"Warum ist der K√∂rperaufschlag effektiv?",options:["Sicherheit","Bewegung blockieren","Weniger Risiko","Winkel"],answer:1,explain:"Der K√∂rperaufschlag schr√§nkt die Schlagbewegung ein."}),
      ()=>({q:"Warum sind Winkel wichtig?",options:["Optik","Court √∂ffnen","Power","Spin"],answer:1,explain:"Winkel zwingen den Gegner aus der Position."}),
      ()=>({q:"Warum ist Konstanz entscheidend?",options:["Tempo","Fehler provozieren","Rally vermeiden","Schnell gewinnen"],answer:1,explain:"Auf hohem Niveau gewinnt Konstanz Matches."}),
      ()=>({q:"Warum Gleichgewicht trainieren?",options:["Stil","Kontrolle","Kraft","Tempo"],answer:1,explain:"Balance erm√∂glicht saubere Schlagtechnik."}),
      ()=>({q:"Warum Anpassungen w√§hrend des Matches?",options:["Gewohnheit","Gegnerentwicklung","Trainer","M√ºdigkeit"],answer:1,explain:"Der Gegner passt sich ebenfalls an."}),
      ()=>({q:"Warum den Gegner analysieren?",options:["Neugier","Schw√§chen erkennen","Selbstvertrauen","Vorbereitung"],answer:1,explain:"Analyse deckt verwertbare Schw√§chen auf."}),
      ()=>({q:"Warum den Rhythmus kontrollieren?",options:["Energie","Dominanz","Stil","Tempo"],answer:1,explain:"Wer den Rhythmus bestimmt, kontrolliert das Spiel."}),
      ()=>({q:"Warum Routinen nutzen?",options:["Zeit","Stabilit√§t","Komfort","Entspannung"],answer:1,explain:"Routinen stabilisieren Leistung unter Druck."}),
      ()=>({q:"Warum Erholung trainieren?",options:["Optik","Position","Energie","Tempo"],answer:1,explain:"Gute Recovery verbessert Court-Abdeckung."}),
      ()=>({q:"Warum Ausdauer aufbauen?",options:["Lange Matches","Kraft","Tempo","Muskelmasse"],answer:0,explain:"Ausdauer h√§lt Leistungsniveau konstant."}),
      ()=>({q:"Warum Mentaltraining betreiben?",options:["Ruhe","Entscheidungen","Fokus","Alles"],answer:3,explain:"Das mentale Spiel beeinflusst alle Aspekte."}),
      ()=>({q:"Warum sich an Bel√§ge anpassen?",options:["Gewohnheit","Absprung","Tempo","Alles"],answer:3,explain:"Jeder Belag ver√§ndert Ballverhalten."}),
      ()=>({q:"Warum sind Breakb√§lle entscheidend?",options:["Punkte","Druck","Momentum","Alles"],answer:3,explain:"Breakb√§lle kippen Matches."}),
      ()=>({q:"Warum unter Druck vereinfachen?",options:["Angst","Klarheit","Tempo","Energie"],answer:1,explain:"Einfachheit reduziert Fehler."}),
      ()=>({q:"Warum der Vorbereitung vertrauen?",options:["Routine","Sicherheit","Ged√§chtnis","Gl√ºck"],answer:1,explain:"Vertrauen senkt Nervosit√§t."}),
      ()=>({q:"Warum Matches analysieren?",options:["Statistik","Weiterentwicklung","Kritik","Ranking"],answer:1,explain:"Analyse f√∂rdert langfristigen Fortschritt."}),
      ()=>({q:"Warum Disziplin wichtig ist?",options:["Regeln","Konstanz","Angst","Kontrolle"],answer:1,explain:"Disziplin schafft Verl√§sslichkeit."}),
      ()=>({q:"Warum Herausforderungen annehmen?",options:["Risiko","Wachstum","Stress","Schmerz"],answer:1,explain:"Herausforderungen f√∂rdern Entwicklung."}),
      ()=>({q:"Warum regelm√§√üig reflektieren?",options:["Ged√§chtnis","Bewusstsein","Routine","Gewohnheit"],answer:1,explain:"Reflexion sch√§rft Spielverst√§ndnis."}),
      ()=>({q:"Warum Meisterschaft anstreben?",options:["Titel","Prozess","Ego","Perfektion"],answer:1,explain:"Meisterschaft ist kontinuierliche Entwicklung."}),
      ()=>({q:"Warum den Weg genie√üen?",options:["Motivation","Langlebigkeit","Balance","Alles"],answer:3,explain:"Freude erh√§lt Leistung langfristig."})
    ]
  },

  /* =========================
     üá≥üá± NEDERLANDS ‚Äî 20 VRAGEN
     ========================= */
  nl: {
    templates: [
      ()=>({q:"Wat is het belangrijkste doel van geavanceerde tennistactiek?",options:["Kracht","Controle","Geluk","Snelheid"],answer:1,explain:"Geavanceerde tactiek is gericht op het controleren van het punt en de tegenstander."}),
      ()=>({q:"Waarom is voetenwerk cruciaal op hoog niveau?",options:["Uiterlijk","Balans en positionering","Kracht","Pure snelheid"],answer:1,explain:"Goed voetenwerk zorgt voor evenwicht en nauwkeurige slagen."}),
      ()=>({q:"Waarom moet een speler zich tactisch aanpassen?",options:["Om te improviseren","Om te reageren op de tegenstander","Om sneller te spelen","Om energie te besparen"],answer:1,explain:"Aanpassing is nodig omdat het spel en de tegenstander veranderen."}),
      ()=>({q:"Waarom moet de service worden gevarieerd?",options:["Om indruk te maken","Om het ritme te breken","Om energie te sparen","Om fouten te vermijden"],answer:1,explain:"Variatie voorkomt dat de tegenstander kan anticiperen."}),
      ()=>({q:"Wat betekent momentum in tennis?",options:["Tempo","Psychologische spelflow","Uithoudingsvermogen","Timing"],answer:1,explain:"Momentum beschrijft de mentale en emotionele dynamiek van een wedstrijd."}),
      ()=>({q:"Waarom zijn crossballen effectief?",options:["Meer kracht","Grotere veiligheid","Meer spin","Visueel effect"],answer:1,explain:"Crossballen geven meer marge over het net en zijn veiliger."}),
      ()=>({q:"Waarom moet je na elke slag terugkeren naar het midden?",options:["Gewoonte","Maximale courtdekking","Energie besparen","Stijl"],answer:1,explain:"De middenpositie maakt snellere reacties mogelijk."}),
      ()=>({q:"Waarom is slice nuttig in verdediging?",options:["Hij is sneller","Hij houdt de bal laag","Hij genereert meer kracht","Hij is nauwkeuriger"],answer:1,explain:"Slice vertraagt het spel en dwingt de tegenstander laag te spelen."}),
      ()=>({q:"Waarom is anticipatie belangrijk?",options:["Geluk","Reflexen","Tijd winnen","Kracht"],answer:2,explain:"Anticipatie verkort de reactietijd en verbetert positionering."}),
      ()=>({q:"Waarom moet een rally worden opgebouwd?",options:["Om te vermoeien","Om fouten af te dwingen","Om tijd te besparen","Om snel te winnen"],answer:1,explain:"Consistent spel dwingt de tegenstander tot fouten."}),
      ()=>({q:"Waarom is netspel belangrijk?",options:["Snelle punten","Ritmeverandering","Dominantie","Energie besparen"],answer:1,explain:"Netspel verandert tempo en ritme van het spel."}),
      ()=>({q:"Waarom moeten slagen worden gemaskeerd?",options:["Stijl","Verrassing","Kracht","Spin"],answer:1,explain:"Verhulling voorkomt vroege anticipatie door de tegenstander."}),
      ()=>({q:"Waarom is emotionele controle essentieel?",options:["Straf vermijden","Heldere beslissingen","Imago","Publiek"],answer:1,explain:"Emotionele stabiliteit verbetert tactische keuzes."}),
      ()=>({q:"Waarom punten plannen?",options:["Routine","Effici√´ntie","Toeval","Geheugen"],answer:1,explain:"Planning verhoogt de kans op succes."}),
      ()=>({q:"Waarom moet het tempo worden gevarieerd?",options:["Versnellen","De tegenstander destabiliseren","Punten afronden","Rust nemen"],answer:1,explain:"Tempowisselingen brengen de tegenstander uit balans."}),
      ()=>({q:"Waarom trainen onder druk?",options:["Stress","Zekerheid","Vermoeidheid","Ongemak"],answer:1,explain:"Druktraining simuleert wedstrijdsituaties."}),
      ()=>({q:"Waarom is visualisatie belangrijk?",options:["Ontspanning","Zelfvertrouwen","Geheugen","Focus"],answer:1,explain:"Visualisatie versterkt mentale voorbereiding."}),
      ()=>({q:"Waarom is de body-serve effectief?",options:["Veiligheid","Beweging beperken","Minder risico","Hoeken"],answer:1,explain:"De body-serve belemmert de slagbeweging van de tegenstander."}),
      ()=>({q:"Waarom zijn hoeken belangrijk?",options:["Uiterlijk","Het court openen","Kracht","Spin"],answer:1,explain:"Hoeken dwingen de tegenstander uit positie."}),
      ()=>({q:"Waarom is consistentie doorslaggevend?",options:["Tempo","Fouten uitlokken","Rallies vermijden","Snel winnen"],answer:1,explain:"Op hoog niveau wint consistentie wedstrijden."}),
      ()=>({q:"Waarom balans trainen?",options:["Stijl","Controle","Kracht","Tempo"],answer:1,explain:"Balans maakt zuivere techniek mogelijk."}),
      ()=>({q:"Waarom aanpassen tijdens de wedstrijd?",options:["Gewoonte","Ontwikkeling van de tegenstander","Coach","Vermoeidheid"],answer:1,explain:"De tegenstander past zich ook aan."}),
      ()=>({q:"Waarom de tegenstander analyseren?",options:["Nieuwsgierigheid","Zwaktes herkennen","Zelfvertrouwen","Voorbereiding"],answer:1,explain:"Analyse onthult benutbare zwaktes."}),
      ()=>({q:"Waarom het ritme controleren?",options:["Energie","Dominantie","Stijl","Tempo"],answer:1,explain:"Wie het ritme bepaalt, controleert het spel."}),
      ()=>({q:"Waarom routines gebruiken?",options:["Tijd","Stabiliteit","Comfort","Ontspanning"],answer:1,explain:"Routines stabiliseren prestaties onder druk."}),
      ()=>({q:"Waarom herstel trainen?",options:["Uiterlijk","Positionering","Energie","Tempo"],answer:1,explain:"Goed herstel verbetert courtdekking."}),
      ()=>({q:"Waarom uithoudingsvermogen opbouwen?",options:["Lange wedstrijden","Kracht","Tempo","Spiermassa"],answer:0,explain:"Uithoudingsvermogen houdt prestaties stabiel."}),
      ()=>({q:"Waarom mentale training doen?",options:["Rust","Besluitvorming","Focus","Alles"],answer:3,explain:"Het mentale spel be√Ønvloedt alle aspecten."}),
      ()=>({q:"Waarom aanpassen aan verschillende ondergronden?",options:["Gewoonte","Stuit","Tempo","Alles"],answer:3,explain:"Elke ondergrond verandert het balgedrag."}),
      ()=>({q:"Waarom zijn breakpoints beslissend?",options:["Punten","Druk","Momentum","Alles"],answer:3,explain:"Breakpoints kunnen wedstrijden kantelen."}),
      ()=>({q:"Waarom vereenvoudigen onder druk?",options:["Angst","Duidelijkheid","Tempo","Energie"],answer:1,explain:"Eenvoud vermindert fouten."}),
      ()=>({q:"Waarom vertrouwen op voorbereiding?",options:["Routine","Zekerheid","Geheugen","Geluk"],answer:1,explain:"Vertrouwen vermindert nervositeit."}),
      ()=>({q:"Waarom wedstrijden analyseren?",options:["Statistiek","Ontwikkeling","Kritiek","Ranking"],answer:1,explain:"Analyse stimuleert langdurige vooruitgang."}),
      ()=>({q:"Waarom is discipline belangrijk?",options:["Regels","Consistentie","Angst","Controle"],answer:1,explain:"Discipline cre√´ert betrouwbaarheid."}),
      ()=>({q:"Waarom uitdagingen aangaan?",options:["Risico","Groei","Stress","Pijn"],answer:1,explain:"Uitdagingen bevorderen ontwikkeling."}),
      ()=>({q:"Waarom regelmatig reflecteren?",options:["Geheugen","Bewustzijn","Routine","Gewoonte"],answer:1,explain:"Reflectie verdiept spelinzicht."}),
      ()=>({q:"Waarom streven naar meesterschap?",options:["Titels","Proces","Ego","Perfectie"],answer:1,explain:"Meesterschap is voortdurende ontwikkeling."}),
      ()=>({q:"Waarom genieten van de reis?",options:["Motivatie","Duurzaamheid","Balans","Alles"],answer:3,explain:"Plezier ondersteunt langdurige prestaties."})
    ]
  }



};


/* build full 100-question pool per language (using templates with small variations) */
function buildPool(lang){
  const L = TEMPLATES[lang];
  const pool = [];
  let i=0, guard=0;
  while(pool.length < 100 && guard++ < 2000){
    const tfn = L.templates[i % L.templates.length];
    // small permutations: append index or swap synonyms for variety
    const base = tfn();
    // Slight perturbation to create variations: add context phrase or shuffle options
    // We'll shuffle options but keep correct answer index corrected.
    let opts = base.options.slice();
    // attempt to create small variant by shuffling options but track new answer index
    const mapped = opts.map((o,idx)=>({o,idx}));
    const s = shuffle(mapped);
    const newOpts = s.map(x=>x.o);
    const newAnswer = s.findIndex(x=>x.idx === base.answer);
    const qText = base.q; // we keep question same for clarity (document fidelity)
    const explain = base.explain || "";
    // Avoid duplicate question+options identical
    const key = qText + '|' + newOpts.join('|');
    if(!pool.find(p=>p.key === key)){
      pool.push({ key, q: qText, options: newOpts, answer: newAnswer, explain });
    }
    i++;
  }
  return shuffle(pool);
}

/* App state */
let LANG = 'en';
let POOLS = {};
let selectedQuestions = [];
let currentIndex = 0;
let selectedAnswers = [];
let score = 0;
const PAGE_SIZE = 20;

/* DOM */
const startBtn = document.getElementById('startBtn');
const guideBtn = document.getElementById('guideBtn');
const qNum = document.getElementById('qNum');
const qText = document.getElementById('qText');
const choicesEl = document.getElementById('choices');
const quizCard = document.getElementById('quizCard');
const introCard = document.getElementById('introCard');
const progBar = document.getElementById('progBar');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const resultCard = document.getElementById('resultCard');
const scoreText = document.getElementById('scoreText');
const feedback = document.getElementById('feedback');
const retakeBtn = document.getElementById('retakeBtn');
const reviewBtn = document.getElementById('reviewBtn');
const exportBtn = document.getElementById('exportBtn');
const mainTitle = document.getElementById('mainTitle');
const subtitle = document.getElementById('subtitle');
const titlePart = document.getElementById('titlePart');
const titleSub = document.getElementById('titleSub');
const leadEl = document.getElementById('lead');
const panelTitle = document.getElementById('panelTitle');
const panelText = document.getElementById('panelText');

/* language buttons */
document.querySelectorAll('.flag-btn').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    const lang = btn.getAttribute('data-lang');
    setLanguage(lang);
  });
});

/* set language UI */
function setLanguage(lang){
  LANG = lang;
  if(!POOLS[LANG]) POOLS[LANG] = buildPool(LANG);
  const u = UI[LANG];
  mainTitle.textContent = u.mainTitle;
  document.title = u.mainTitle;
  subtitle.textContent = u.subtitle;
  titlePart.textContent = u.mainTitle + " ‚Äî ";
  titleSub.textContent = u.subtitle;
  leadEl.textContent = u.lead;
  startBtn.textContent = u.start;
  guideBtn.textContent = u.guide;
  nextBtn.textContent = u.next;
  prevBtn.textContent = u.prev;
  retakeBtn.textContent = u.retake;
  reviewBtn.textContent = u.review;
  exportBtn.textContent = u.exportCsv || u.exportCsv || 'Export CSV';
  panelTitle.textContent = u.panelTitle;
  panelText.textContent = u.how;
  document.querySelectorAll('.flag-btn').forEach(b=>b.style.opacity = b.getAttribute('data-lang')===LANG? '1' : '0.6');
  // show intro
  introCard.style.display='block';
  quizCard.style.display='none';
  resultCard.style.display='none';
  feedback.textContent='';
}

/* init */
setLanguage(LANG);

/* start quiz */
function startQuiz(){
  if(!POOLS[LANG]) POOLS[LANG] = buildPool(LANG);
  selectedQuestions = shuffle(POOLS[LANG]).slice(0,PAGE_SIZE);
  currentIndex = 0;
  selectedAnswers = Array(PAGE_SIZE).fill(null);
  score = 0;
  introCard.style.display='none';
  quizCard.style.display='block';
  resultCard.style.display='none';
  renderQuestion();
  updateButtons();
  updateProgress();
}


// keep language when going home
document.getElementById('homeBtn')?.addEventListener('click', () => {
  localStorage.setItem('lang', LANG);
});


/* render question */
function renderQuestion(){
  const item = selectedQuestions[currentIndex];
  qNum.textContent = `${currentIndex+1} / ${PAGE_SIZE}`;
  qText.textContent = item.q;
  choicesEl.innerHTML = '';
  item.options.forEach((opt, idx)=>{
    const d = document.createElement('div');
    d.className = 'choice';
    if(selectedAnswers[currentIndex] === idx) d.classList.add('selected');
    d.innerHTML = `<div class="label">${String.fromCharCode(65+idx)}. ${opt}</div><div class="meta"></div>`;
    d.onclick = ()=> selectOption(idx);
    choicesEl.appendChild(d);
  });
}

/* select */
function selectOption(idx){
  selectedAnswers[currentIndex] = idx;
  Array.from(choicesEl.children).forEach((c,i)=> c.classList.toggle('selected', i===idx));
  updateButtons();
}

/* nav */
prevBtn.addEventListener('click', ()=> {
  if(currentIndex>0){ currentIndex--; renderQuestion(); updateButtons(); updateProgress(); }
});
nextBtn.addEventListener('click', ()=> {
  if(selectedAnswers[currentIndex] === null){ alert(UI[LANG].selectPrompt || 'Choose an answer'); return; }
  if(currentIndex < PAGE_SIZE-1){ currentIndex++; renderQuestion(); updateButtons(); updateProgress(); }
  else finishQuiz();
});
function updateButtons(){
  prevBtn.disabled = currentIndex === 0;
  nextBtn.textContent = currentIndex === PAGE_SIZE-1 ? (UI[LANG].review || 'Finish') : UI[LANG].next;
}
function updateProgress(){
  const pct = Math.round((currentIndex / PAGE_SIZE) * 100);
  progBar.style.width = pct + '%';
}

/* finish */
function finishQuiz(){
  score = 0;
  selectedQuestions.forEach((q,i)=> { if(selectedAnswers[i] === q.answer) score++; });
  scoreText.textContent = `${score} / ${PAGE_SIZE}`;
  // simple level labels
  let levelTxt = '';
  if(score <= 4) levelTxt = LANG==='fr' ? 'D√©butant' : LANG==='de'? 'Anf√§nger' : LANG==='nl' ? 'Beginner' : 'Rookie';
  else if(score <= 9) levelTxt = LANG==='fr' ? 'Strat√®ge en formation' : LANG==='de' ? 'Taktiker in Ausbildung' : LANG==='nl' ? 'Strategie in opleiding' : 'Strategist in Training';
  else if(score <= 15) levelTxt = LANG==='fr' ? 'Penseur tactique' : LANG==='de' ? 'Taktischer Denker' : LANG==='nl' ? 'Tactische denker' : 'Tactical Thinker';
  else levelTxt = LANG==='fr' ? 'Ma√Ætre du mental' : LANG==='de' ? 'Meister des Geistes' : LANG==='nl' ? 'Meester van de geest' : 'Master of Mind';
  document.getElementById('levelInfo').innerHTML = `<div style="font-weight:800;color:var(--accent)">${levelTxt}</div><div class="small">${Math.round(score/PAGE_SIZE*100)}%</div>`;
  const fb = {
    fr: ["Travaille la base : respiration et observation.","Connais les principes ; r√©p√®te en situation de jeu.","Bonne lecture mentale ; peaufine la pratique d√©tendue.","Excellent : poursuis l'int√©gration quotidienne."],
    en: ["Work the basics: breathing and observation.","Know the principles; rehearse in match contexts.","Good mental reading; refine relaxed practice.","Excellent: continue integrating daily."],
    de: ["Arbeite an Grundlagen: Atmung und Beobachtung.","Kenne die Prinzipien; √ºbe in Spielsituationen.","Gute mentale Lesef√§higkeit; entspannte Praxis verfeinern.","Ausgezeichnet: weiter integrieren."],
    nl: ["Oefen de basis: ademhaling en observatie.","Ken de principes; oefen in wedstrijdcontext.","Goed mentaal inzicht; verfijn ontspannen oefenen.","Uitstekend: blijf dagelijks integreren."]
  };
  feedback.textContent = fb[LANG][ Math.min(3, Math.floor(score / (PAGE_SIZE/4))) ];
  quizCard.style.display='none';
  resultCard.style.display='block';
  progBar.style.width = '100%';
}

/* review: open new window with explanations and color coding */
function reviewAll(){
  const win = window.open('', '_blank', 'width=900,height=800,scrollbars=yes');
  const doc = win.document;
  doc.write('<!doctype html><html><head><meta charset="utf-8"><title>Review</title>');
  doc.write('<style>body{font-family:Arial;padding:18px;background:#f7f9fc;color:#0b1224} .review-q{background:#fff;padding:14px;border-radius:10px;margin-bottom:12px;border:1px solid #eef2f7} .review-opt{padding:10px;border-radius:8px;margin:8px 0;display:flex;justify-content:space-between;align-items:center} .sel{background:linear-gradient(180deg,#efe0ff,#efe6ff);border:1px solid #b08cff} .corr{background:linear-gradient(180deg,#e8f8ec,#dff5e6);border:1px solid #8dd39a} .wr{background:linear-gradient(180deg,#ffecec,#ffd6d6);border:1px solid #f19b9b} .explain{margin-top:8px;padding-left:6px;font-size:14px;color:#0b1224} h2{margin-top:0}</style>');
  doc.write('</head><body>');
  doc.write('<h2>' + (UI[LANG].mainTitle) + ' ‚Äî Review</h2>');
  doc.write('<p><strong>' + (UI[LANG].resYourScore || 'Score') + ':</strong> ' + score + ' / ' + PAGE_SIZE + '</p>');
  selectedQuestions.forEach((q,i)=>{
    doc.write('<div class="review-q"><strong>' + (i+1) + '. ' + q.q + '</strong>');
    q.options.forEach((opt,j)=>{
      let cls='review-opt';
      let mark='';
      if(j===q.answer){ cls += ' corr'; mark='‚úÖ'; }
      if(selectedAnswers[i]===j && j!==q.answer){ cls += ' wr'; mark='‚ùå'; }
      if(selectedAnswers[i]===j){ cls += ' sel'; }
      doc.write('<div class="' + cls + '"><div>' + String.fromCharCode(65+j) + '. ' + opt + '</div><div style="font-weight:700">' + mark + '</div></div>');
    });
    if(q.explain){ doc.write('<div class="explain"><strong>Explication :</strong> ' + q.explain + '</div>'); }
    doc.write('</div>');
  });
  doc.write('</body></html>');
  doc.close();
}

/* export CSV */
function exportCSV(){
  const rows = [];
  const header = ['timestamp','language','score','qIndex','question','selectedIndex','selectedText','correctIndex','correctText','explain'];
  rows.push(header);
  const ts = new Date().toISOString();
  selectedQuestions.forEach((q,i)=>{
    const selIdx = selectedAnswers[i] !== null ? selectedAnswers[i] : '';
    const selText = selIdx !== '' ? q.options[selIdx] : '';
    const corrIdx = q.answer;
    const corrText = q.options[corrIdx];
    rows.push([ts, LANG, score + '/' + PAGE_SIZE, i+1, q.q.replace(/[\n\r]+/g,' '), selIdx, selText.replace(/,/g,';'), corrIdx, corrText.replace(/,/g,';'), (q.explain || '').replace(/[\n\r]+/g,' ')]);
  });
  const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `mental_tennis_${LANG}_${(new Date()).toISOString().slice(0,19).replace(/[:T]/g,'-')}.csv`;
  document.body.appendChild(a);
  a.click();
  URL.revokeObjectURL(url);
  a.remove();
}

/* hooks */
startBtn.addEventListener('click', startQuiz);
retakeBtn.addEventListener('click', startQuiz);
reviewBtn.addEventListener('click', reviewAll);
exportBtn.addEventListener('click', exportCSV);
guideBtn.addEventListener('click', ()=> alert(UI[LANG].how));

/* keyboard support */
document.addEventListener('keydown', (e)=>{
  if(quizCard.style.display==='block'){
    if(['1','2','3','4'].includes(e.key)){
      const idx = parseInt(e.key,10)-1;
      const opts = document.querySelectorAll('.choice');
      if(opts[idx]) selectOption(idx);
    } else if(e.key === 'Enter'){ nextBtn.click(); }
  }
});

/* click-to-select */
choicesEl.addEventListener('click', (e)=>{
  let el = e.target;
  while(el && !el.classList.contains('choice')) el = el.parentElement;
  if(!el) return;
  const nodes = Array.from(choicesEl.children);
  const idx = nodes.indexOf(el);
  if(idx>=0) selectOption(idx);
});

/* ensure first pool */
if(!POOLS[LANG]) POOLS[LANG] = buildPool(LANG);
</script>
</body>
</html>
